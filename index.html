<script>
        const { createFFmpeg, fetchFile } = FFmpeg;

        // ğŸŸ¢ ä½¿ç”¨é¥¿äº†ä¹ˆ (Eleme) å›½å†… CDN é•œåƒ
        // è¿™ä¼šç›´æ¥ä»é˜¿é‡Œäº‘çš„æœåŠ¡å™¨ä¸‹è½½æ ¸å¿ƒæ–‡ä»¶ï¼Œé€Ÿåº¦æå¿«
        const CDN_BASE = 'https://npm.elemecdn.com/@ffmpeg/core@0.11.0/dist/';

        console.log("æ­£åœ¨ä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿ:", CDN_BASE);

        const ffmpeg = createFFmpeg({ 
            log: true,
            // å¼ºåˆ¶æŒ‡å®šä¸‰ä¸ªæ–‡ä»¶éƒ½èµ°å›½å†…é•œåƒ
            corePath: CDN_BASE + 'ffmpeg-core.js',
            workerPath: CDN_BASE + 'ffmpeg-core.worker.js',
            wasmPath: CDN_BASE + 'ffmpeg-core.wasm' 
        });

        const transcode = async ({ target: { files } }) => {
            const status = document.getElementById('status');
            const btn = document.getElementById('downloadBtn');
            const file = files[0];
            if (!file) return;

            status.innerText = 'æ­£åœ¨é«˜é€ŸåŠ è½½å¼•æ“ (é¦–æ¬¡è¿è¡Œéœ€ä¸‹è½½ï¼Œåç»­ç§’å¼€)...';
            btn.style.display = 'none';

            try {
                if (!ffmpeg.isLoaded()) await ffmpeg.load();

                status.innerText = 'æ­£åœ¨å¤„ç†: ' + file.name;
                ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));
                
                // æ‰§è¡Œå‘½ä»¤
                await ffmpeg.run('-itsscale', '2', '-i', 'input.mp4', '-c', 'copy', 'output.mp4');

                status.innerText = 'å¤„ç†å®Œæˆï¼';
                const data = ffmpeg.FS('readFile', 'output.mp4');
                const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
                
                btn.onclick = () => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `[60]${file.name.split('.')[0]}.mp4`;
                    a.click();
                };
                btn.style.display = 'inline-block';
            } catch (err) {
                console.error(err);
                // å¦‚æœæŠ¥é”™ï¼Œæç¤ºç”¨æˆ·æ£€æŸ¥ Service Worker
                status.innerText = 'å‡ºé”™: ' + err.message + '\nå¦‚æœä¸€ç›´åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿ coi-serviceworker.js æ–‡ä»¶å­˜åœ¨ä¸”å·²ä¸Šä¼ ã€‚';
            }
        };
        document.getElementById('uploader').addEventListener('change', transcode);
    </script>
